<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Godot - 0 protection</title>
    <link rel="stylesheet" href="../style.css">
  </head>
  <body>
    <div class="conteneur">
      <h1>Godot - 0 protection</h1>

      <p>Let's analyze this binary using the <code>file</code> command.</p>

      <pre><code class="language-bash">
yoyo@LAPTOP:~/M1/S2/SL/rootme/craking$ file 0_protection.exe
      </code></pre>

      <p>The file <code>0_protection.exe</code> is a PE32+ executable for 64-bit Windows, intended for a graphical user interface (GUI). 
      Although it has been "stripped" to remove internal debugging information, it retains an external PDB file that can be used for analysis and debugging. 
      Once again, as indicated, no obfuscation methods are used. 
      The given executable is a game created with the Godot game engine. 
      Godot cannot export .exe files directly, but there is a way to unpack Godot archives contained in the executable. 
      On TehSkai's GitHub repository, one can download a Python script that takes a .exe built with Godot and unpacks its archives. 
      Again, no obfuscation methods are used.</p>

      <pre><code class="language-bash">yoyo@LAPTOP:~/M1/S2/SL/rootme/craking$ python3 godot-unpacker.py 0_protection.exe
0_protection.exe looks like a self-contained .exe
0_protection.exe info: (1129333831, 1, 3, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 27)
Reading metadata...
Unpacking 27 files...
      </code></pre>

      <p>The folder <code>0_protection_exe</code> is then created, containing the content of <code>0_protection.exe</code>. 
      Inside <code>0_protection_exe/res/src</code>, there are four source files: <code>FlagLabel.gd</code>, <code>MainMenu.gd</code>, <code>Player.gd</code>, and <code>StartButton.gd</code>. 
      The file of interest is <code>FlagLabel.gd</code>, which is a GDScript code (the language used by Godot) performing a decryption based on an XOR operation between the values of the <code>key</code> and <code>enc</code> lists. 
      We isolate and adapt this code so it conforms to Python syntax.</p>

      <pre><code class="language-bash">key = [119, 104, 52, 116, 52, 114, 51, 121, 48, 117, 100, 48, 49, 110, 103, 63]
enc = [32, 13, 88, 24, 20, 22, 92, 23, 85, 89, 68, 68, 89, 11, 71, 89, 27, 9, 83, 84, 93, 1, 57, 42, 83, 7, 13, 96, 69, 29, 86, 81, 52, 4, 7, 64, 70]

text = ""
for i in range(len(enc)):
  text += chr(enc[i] ^ key[i % len(key)])
print(text)
      </code></pre>

      <p>After execution, we obtain:</p>

      <pre><code class="language-bash">yoyo@LAPTOP:~/M1/S2/SL/rootme/craking/0_protection_exe$ python3 code.py 
Well done, the flag is
&lt;censored&gt;
      </code></pre>

    </div>
  </body>
</html>
